<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reparto Chuli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
    #map { height: 80vh; width: 100%; }
    #controls { padding: 10px; background: #f5f5f5; }
    input, button { padding: 8px; margin: 5px 0; width: 100%; }
  </style>
</head>
<body>

  <div id="controls">
    <h2>🚚 Reparto Chuli</h2>
    <input type="text" id="address" placeholder="Escribe una dirección">
    <button onclick="addAddress()">Agregar destino</button>
    <button onclick="optimizeRoute()">Optimizar ruta</button>
    <ul id="destinations"></ul>
  </div>

  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    // Tu API Key nueva
    const GOOGLE_MAPS_API_KEY = "AIzaSyDzXI4BChN3SN5geF3BNDZl8uOCyDhaw20";

    // Inicializar mapa
    const map = L.map('map').setView([-38.0055, -57.5426], 13); // Mar del Plata por defecto
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    let destinations = [];
    let markers = [];

    async function addAddress() {
      const address = document.getElementById("address").value;
      if (!address) return;

      // Llamada a Google Geocoding
      const response = await fetch(
        `https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(address)}&key=${GOOGLE_MAPS_API_KEY}`
      );
      const data = await response.json();

      if (data.status === "OK") {
        const location = data.results[0].geometry.location;
        destinations.push({ address, lat: location.lat, lng: location.lng });

        // Agregar marcador al mapa
        const marker = L.marker([location.lat, location.lng]).addTo(map)
          .bindPopup(address)
          .openPopup();
        markers.push(marker);

        // Mostrar lista
        const li = document.createElement("li");
        li.textContent = address;
        document.getElementById("destinations").appendChild(li);

        map.setView([location.lat, location.lng], 14);
        document.getElementById("address").value = "";
      } else {
        alert("No se encontró la dirección");
      }
    }

    function optimizeRoute() {
      if (markers.length < 2) {
        alert("Agrega al menos dos destinos");
        return;
      }

      // Dibujar la ruta en orden ingresado (versión simple)
      const latlngs = destinations.map(d => [d.lat, d.lng]);
      L.polyline(latlngs, { color: 'blue' }).addTo(map);
      map.fitBounds(latlngs);
    }
  </script>

</body>
</html>
